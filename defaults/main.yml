---
# Roughly follows kolla-ansible's service deployment patterns.

# Action to perform. One of 'deploy', 'destroy', 'pull', 'reconfigure',
# 'upgrade'.
mlnx_ufm_action: deploy

# Whether UFM is enabled.
mlnx_ufm_enabled: true

# Service deployment definition.
mlnx_ufm_services:
  mlnx_ufm:
    container_name: mlnx_ufm
    enabled: "{{ mlnx_ufm_enabled }}"
    image: "{{ mlnx_ufm_image_full }}"
    network_mode: host
    privileged: true
    # Ideally we'd define these tmpfs mounts, but the tmpfs argument is not
    # supported by the docker_container Ansible module until Ansible 2.4.
    #tmpfs:
    #  - "/run"
    #  - "/tmp"
    volumes:
      - "/etc/localtime:/etc/localtime:ro"
      # Ensures the container can see which modules are available.
      - "/lib/modules:/lib/modules:ro"
      - "{{ mlnx_ufm_config_path }}/mlnx-ufm-configure:/usr/bin/mlnx-ufm-configure:ro"
      - "{{ mlnx_ufm_config_path }}/licenses:/opt/ufm/files/licenses/:ro"
      - "mlnx_ufm_conf:/opt/ufm/files/conf"
      - "mlnx_ufm_files:/opt/ufm/files"
      - "mlnx_ufm_logs:/opt/ufm/files/log"

# Image used to create the container.
mlnx_ufm_image:
mlnx_ufm_tag: "latest"
mlnx_ufm_image_full: "{{ mlnx_ufm_image }}:{{ mlnx_ufm_tag }}"

# Container restart policy.
mlnx_ufm_restart_policy: "unless-stopped"
mlnx_ufm_restart_retries: 10

# Path to a script template on localhost containing UFM startup configuration.
mlnx_ufm_startup_config_path: "/etc/mlnx-ufm/mlnx-ufm-configure"

# Path to a directory on localhost containing Mellanox UFM licenses.
mlnx_ufm_licenses_path: "/etc/mlnx-ufm/licenses"

# Path to a directory on the remote host to store configuration.
mlnx_ufm_config_path: "/etc/mlnx-ufm"
